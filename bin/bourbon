#!/usr/bin/env node

var program = require('commander'),
    path = require('path'),
    fs = require('fs'),
    ncp = require('ncp'),
    Bourbon = require('../lib/bourbon.js');

program
    .version('0.0.1');

var template_folder = path.join(__dirname, '../template');

program
    .command('new <path>')
    .action(function(dest, options) {
        dest = path.resolve(dest);

        ncp(template_folder, dest, function(err) {
            if (err) {
                return console.error(err)
            }

            console.log('Bourbon site created successfully')
        });
    });

program
    .command('run [path]')
    .action(function(dir, options) {
        var dir = dir || process.cwd();
        dir = path.resolve(dir);

        // If a script named app.js exists, run that instead
        if (fs.existsSync(path.join(dir, 'app.js'))) {
            require(path.join(dir, 'app.js'));
        } else {
            // TODO: Handle error case where this file doesn't exist
            var config = require(path.join(dir, 'config.json'));

            var bourbon = new Bourbon(config.templates, {
                cache: config.cache
            });

            // Add the jobs directory
            bourbon.jobs(jobs);

            // Start it off
            bourbon.start();
        }
    });

program.parse(process.argv);